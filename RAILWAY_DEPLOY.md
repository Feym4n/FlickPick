# Инструкция по деплою на Railway

## Почему Railway?

Railway идеально подходит для Socket.IO приложений:
- ✅ **Постоянные процессы** (не serverless) - Socket.IO работает стабильно
- ✅ **Нет холодного старта** - мгновенная реакция
- ✅ **Стабильные WebSocket соединения** - нет разрывов
- ✅ **Бесплатный план** - 500 часов в месяц (достаточно для тестирования)
- ✅ **Автоматический деплой** из GitHub
- ✅ **Простая настройка** - минимум конфигурации

## Шаг 1: Регистрация на Railway

1. Перейдите на https://railway.app
2. Нажмите "Login" и войдите через GitHub
3. Подтвердите доступ к вашему GitHub аккаунту

## Шаг 2: Создание проекта

1. В Railway нажмите **"New Project"**
2. Выберите **"Deploy from GitHub repo"**
3. Выберите репозиторий `Feym4n/FlickPick`
4. Railway автоматически определит Next.js и начнет деплой

**Важно:** Railway автоматически предоставляет переменную `PORT` - Next.js использует её автоматически.

## Шаг 3: Настройка переменных окружения

В настройках проекта (Settings → Variables) добавьте все переменные:

### Обязательные переменные:

```
# Кинопоиск API
KINOPOISK_API_KEY=ваш_ключ_кинопоиск

# Socket.IO (Railway автоматически предоставит URL после деплоя)
ALLOWED_ORIGINS=https://ваш-проект.up.railway.app
```

### Firebase переменные (из вашего .env.local):

```
FIREBASE_PROJECT_ID=ваш_project_id
FIREBASE_CLIENT_EMAIL=ваш_client_email
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nваш_ключ\n-----END PRIVATE KEY-----\n"
FIREBASE_API_KEY=ваш_api_key
FIREBASE_AUTH_DOMAIN=ваш_auth_domain
FIREBASE_STORAGE_BUCKET=ваш_storage_bucket
FIREBASE_MESSAGING_SENDER_ID=ваш_sender_id
FIREBASE_APP_ID=ваш_app_id
```

**Важно для FIREBASE_PRIVATE_KEY:**
- В Railway нужно добавить ключ с переносами строк как `\n`
- Или скопировать весь ключ с переносами строк

## Шаг 4: Получение URL

1. После деплоя Railway предоставит URL вида: `https://ваш-проект.up.railway.app`
2. Скопируйте этот URL
3. Обновите переменную `ALLOWED_ORIGINS` этим URL (если еще не сделали)
4. Railway может предоставить кастомный домен в настройках

## Шаг 5: Проверка деплоя

1. Откройте URL вашего приложения
2. Проверьте, что приложение загружается
3. Проверьте WebSocket соединение (должен быть зеленый индикатор)
4. Протестируйте создание группы и добавление фильмов

## Отличия от Vercel:

| Vercel | Railway |
|--------|---------|
| Serverless функции | Постоянные процессы |
| Холодный старт (1-2 сек) | Мгновенный старт |
| Проблемы с WebSocket | Стабильные WebSocket |
| Переподключения | Нет переподключений |
| Задержки синхронизации | Мгновенная синхронизация |

## Решение проблем:

### Если деплой не работает:
1. Проверьте логи в Railway (View Logs)
2. Убедитесь, что все переменные окружения добавлены
3. Проверьте, что `PORT` не нужно указывать вручную (Railway делает это автоматически)

### Если WebSocket не работает:
1. Проверьте `ALLOWED_ORIGINS` - должен совпадать с URL Railway
2. Проверьте логи - должны быть сообщения о подключении Socket.IO
3. Убедитесь, что используется правильный URL (Railway предоставляет его автоматически)

## Стоимость:

- **Бесплатный план:** 500 часов в месяц (достаточно для тестирования)
- **Hobby план:** $5/месяц - неограниченное время работы
- **Pro план:** $20/месяц - больше ресурсов

Для начала бесплатного плана более чем достаточно!

